---
import BaseLayout from './BaseLayout.astro';
import TopNav from '../components/layout/TopNav.astro';
import Sidebar from '../components/layout/Sidebar.astro';
import Footer from '../components/layout/Footer.astro';
import ReadingProgress from '../components/interactive/ReadingProgress.jsx';
import TableOfContents from '../components/interactive/TableOfContents.jsx';

interface Props {
  title?: string;
  description?: string;
  roadmapSlug?: string;
  sections?: Array<{ id: string; title: string; level?: number }>;
}

const {
  title = 'Roadmap',
  description,
  roadmapSlug = 'general',
  sections = [],
} = Astro.props;
---

<BaseLayout title={title} description={description}>
  <!-- Reading Progress Bar -->
  <ReadingProgress client:load />

  <!-- Top Navigation -->
  <TopNav />

  <!-- Main Container -->
  <div class="flex flex-1 min-h-[calc(100vh-4rem)]">
    <!-- Sidebar (Left Column) - Desktop Only -->
    <Sidebar roadmapSlug={roadmapSlug} sections={sections} />

    <!-- Main Content (Center Column) -->
    <main class="flex-1 lg:ml-64 lg:mr-64">
      <article class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
        <!-- Page Header -->
        {title && (
          <header class="mb-8">
            <h1 class="text-4xl sm:text-5xl font-bold text-primary-dark dark:text-blue-400 mb-2">
              {title}
            </h1>
            {description && (
              <p class="text-lg text-gray-600 dark:text-gray-400">
                {description}
              </p>
            )}
          </header>
        )}

        <!-- Content -->
        <div class="prose dark:prose-invert max-w-none">
          <slot />
        </div>

        <!-- Navigation between sections -->
        <nav class="mt-12 pt-8 border-t border-gray-200 dark:border-slate-700 flex justify-between gap-4">
          <div>
            <button
              onclick="window.history.back()"
              class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors text-sm font-medium"
            >
              ← Əvvəl
            </button>
          </div>
          <div>
            <button
              onclick="window.history.forward()"
              class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors text-sm font-medium"
            >
              Sonra →
            </button>
          </div>
        </nav>
      </article>
    </main>

    <!-- Table of Contents (Right Column) - Desktop Only -->
    <div class="hidden xl:block fixed right-0 top-16 w-64 h-[calc(100vh-4rem)] px-4 py-8">
      <TableOfContents client:load />
    </div>
  </div>

  <!-- Footer -->
  <Footer />
</BaseLayout>

<style is:global>
  /* Keyboard shortcuts hint */
  @media (min-width: 640px) {
    main {
      transition: margin-left 0.2s ease;
    }
  }
</style>

<script>
  // Keyboard navigation: arrow keys for prev/next
  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft') {
      document.querySelector('button')?.click();
    } else if (e.key === 'ArrowRight') {
      document.querySelectorAll('button')[1]?.click();
    }
  });
</script>
